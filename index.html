<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dotazn√≠k mor√°lneho spr√°vania, odolnosti a emocion√°lnej stability</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
import React, { useState, useEffect } from 'react';
import { ChevronRight, ChevronLeft, BarChart3 } from 'lucide-react';

const ComprehensiveQuestionnaire = () => {
  const [showIntro, setShowIntro] = useState(true);
  const [showDemographics, setShowDemographics] = useState(false);
  const [consent, setConsent] = useState(false);
  const [demographics, setDemographics] = useState({
    age: '',
    gender: '',
    education: '',
    relationship: '',
    socialStatus: '',
    religious: ''
  });
  const [currentSection, setCurrentSection] = useState(0);
  const [responses, setResponses] = useState({});
  const [showResults, setShowResults] = useState(false);
  const [dataSaved, setDataSaved] = useState(false);

  // Pridaj CSS pre mobiln√© zariadenia
  useEffect(() => {
    const style = document.createElement('style');
    style.textContent = `
      @media (max-width: 768px) {
        .container { padding: 12px !important; }
        h1 { font-size: 24px !important; line-height: 1.2 !important; }
        h2 { font-size: 20px !important; }
        h3 { font-size: 18px !important; }
        p { font-size: 14px !important; }
        button { font-size: 14px !important; min-height: 44px !important; }
        .prose p { font-size: 14px !important; }
        input[type="radio"], input[type="checkbox"] { min-width: 20px !important; min-height: 20px !important; }
        .overflow-x-auto { -webkit-overflow-scrolling: touch; }
      }

      @media (max-width: 640px) {
        body { font-size: 14px; }
        .max-w-4xl, .max-w-3xl { max-width: 100% !important; padding: 0 8px !important; }
        .p-6, .p-8 { padding: 16px !important; }
        .px-6 { padding-left: 12px !important; padding-right: 12px !important; }
        .py-3 { padding-top: 12px !important; padding-bottom: 12px !important; }
        .gap-4 { gap: 8px !important; }
        .space-y-6 > * + * { margin-top: 16px !important; }
        .text-3xl { font-size: 22px !important; }
        .text-2xl { font-size: 20px !important; }
        .text-xl { font-size: 18px !important; }
        table { font-size: 12px !important; }
        th, td { padding: 6px 4px !important; }
      }
    `;
    document.head.appendChild(style);
    return () => document.head.removeChild(style);
  }, []);

  // Funkcia na vytvorenie fixn√©ho n√°hodn√©ho poradia (seeded shuffle)
  const seededShuffle = (array, seed) => {
    const arr = [...array];
    let currentSeed = seed;
    
    const seededRandom = () => {
      currentSeed = (currentSeed * 9301 + 49297) % 233280;
      return currentSeed / 233280;
    };
    
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(seededRandom() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  };

  const miqQuestions = [
    { text: "Veƒæmi sa sna≈æ√≠m spr√°va≈• ƒçestne pri v√§ƒç≈°ine veci, ktor√© rob√≠m.", reverse: false, originalId: 1 },
    { text: "Neubli≈æova≈• ostatn√Ωm ƒæuƒèom je jedno z pravidiel, podƒæa ktor√©ho sa sna≈æ√≠m ≈æi≈•.", reverse: false, originalId: 2 },
    { text: "Je pre m≈àa d√¥le≈æit√© spr√°va≈• k ƒæuƒèom f√©rovo.", reverse: false, originalId: 3 },
    { text: "Chcem aby ostatn√≠ ƒæudia vedeli, ≈æe sa na m≈àa m√¥≈æu spoƒæahn√∫≈•.", reverse: false, originalId: 4 },
    { text: "V≈ædy kon√°m sp√¥sobom, ktor√Ω prin√°≈°a ƒço najviac dobra a ƒço najmenej ≈°kod√≠ ostatn√Ωm ƒæuƒèom.", reverse: false, originalId: 5 },
    { text: "Ak robenie nieƒçoho ubl√≠≈æi inej osobe, sna≈æ√≠m sa tomu vyhn√∫≈•, aj keby o tom nikto nevedel.", reverse: false, originalId: 6 },
    { text: "Jednou z najd√¥le≈æitej≈°√≠ch vec√≠ v ≈æivote je robi≈• to ƒço vie≈°, ≈æe je spr√°vne.", reverse: false, originalId: 7 },
    { text: "Keƒè sa raz rozhodnem o tom, ƒço je spr√°vne urobi≈•, tak to aj urob√≠m.", reverse: false, originalId: 8 },
    { text: "Pokiaƒæ sa rozhodnem spravi≈• nieƒço ƒço mi pom√¥≈æe, nez√°le≈æ√≠ na tom, ƒçi bude in√Ωm ƒæuƒèom sp√¥soben√° ujma.", reverse: true, originalId: 9 },
    { text: "Je v poriadku spravi≈• nieƒço, o ƒçom vie≈°, ≈æe je nespr√°vne, ak odmena za to je skvel√°.", reverse: true, originalId: 10 },
    { text: "Ak sa nikto nepozer√° alebo o tom nikto nebude vedie≈•, tak nez√°le≈æ√≠ na tom ƒçi urob√≠m spr√°vnu vec.", reverse: true, originalId: 11 },
    { text: "Je d√¥le≈æitej≈°ie, ak si ƒæudia myslia, ≈æe som ƒçestn√Ω, ne≈æ by≈• skutoƒçne ƒçestn√Ω.", reverse: true, originalId: 12 },
    { text: "Ak na to nikto nepr√≠de, tak je v poriadku ukradn√∫≈• mal√∫ ƒçiastku pe≈àaz√≠ ƒçi in√Ωch vec√≠, ktor√© nebud√∫ nikomu ch√Ωba≈•.", reverse: true, originalId: 13 },
    { text: "Nem√° zmysel vynaklada≈• maxim√°lne √∫silie na to, aby som urobil nieƒço dobr√©, ak nie je nabl√≠zku nikto, kto by to ocenil.", reverse: true, originalId: 14 },
    { text: "Ak mi pokladn√≠k omylom vyd√° o 10 eur navy≈°e, zvyƒçajne sa tv√°rim, akoby som si to nev≈°imol.", reverse: true, originalId: 15 },
    { text: "Klamanie a podv√°dzanie s√∫ veci, ktor√© jednoducho mus√≠≈° v dne≈°nom svete robi≈•.", reverse: true, originalId: 16 },
    { text: "Robi≈• veci, ktor√© niektor√≠ ƒæudia m√¥≈æu pova≈æova≈• za neƒçestn√©, mi nevad√≠.", reverse: true, originalId: 17 },
    { text: "Ak sa ku mne ƒæudia spr√°vaj√∫ zle, budem sa k nim spr√°va≈• rovnak√Ωm sp√¥sobom.", reverse: true, originalId: 18 },
    { text: "S√∫hlas√≠m s rozhodnut√≠m skupiny, aj keƒè viem, ≈æe je to mor√°lne nespr√°vne.", reverse: true, originalId: 19 },
    { text: "Ma≈• mor√°lne hodnoty je v dne≈°nej spoloƒçnosti zbytoƒçn√©.", reverse: true, originalId: 20 }
  ];

  // Pou≈æijeme fixn√Ω seed pre n√°hodn√© poradie (v≈ædy rovnak√©)
  const shuffledMiqQuestions = seededShuffle(miqQuestions, 12345);

  const workerDilemma = "Ned√°vno jedna spoloƒçnos≈• prepustila niekoƒæko zamestnancov z nezn√°mych d√¥vodov. Niektor√≠ zamestnanci si myslia, ≈æe ≈°√©fovia odpoƒç√∫vaj√∫ ich s√∫kromn√© konverz√°cie cez kamery a mikrof√≥ny v budove a pou≈æ√≠vaj√∫ tieto inform√°cie proti nim. ≈†√©fovia v≈°ak tvrdia, ≈æe ich neodpoƒç√∫vaj√∫. Zamestnanci nem√¥≈æu leg√°lne niƒç urobi≈• pokiaƒæ nedok√°≈æu, ≈æe ≈°√©fovia odpoƒç√∫vaj√∫ ich s√∫kromn√© rozhovory, preto sa dvaja zo zamestnancov vl√°mu do hlavnej kancel√°rie a vezm√∫ nahr√°vky, ktor√© dokazuj√∫, ≈æe ich ≈°√©fovia naozaj odpoƒç√∫vaj√∫.";

  const doctorDilemma = "Jedna ≈æena mala rakovinu a nemala ≈æiadnu n√°dej na z√°chranu. Bola v hrozn√Ωch bolestiach a bola tak slab√°, ≈æe veƒæk√° d√°vka liekov proti bolesti, ako morfium, by jej sp√¥sobili smr≈•. Poƒças kr√°tkeho obdobia zlep≈°enia prosila lek√°ra, aby jej dal dostatok morfia na to, aby ju zabil. Povedala, ≈æe u≈æ nedok√°≈æe dlh≈°ie zn√°≈°a≈• boles≈• a tak ƒçi tak by o p√°r t√Ω≈æd≈àov umrela. Po kr√°tkom prem√Ω≈°ƒæan√≠ sa lek√°r rozhodol da≈• jej nadmern√∫ d√°vku morfia.";

  const workerQuestions = [
    { q: "S√∫hlasili by ste alebo nes√∫hlasili s konan√≠m pracovn√≠kov?", type: "7point" },
    { q: "Bolo spr√°vne vl√°ma≈• sa, preto≈æe nesp√¥sobili spoloƒçnosti veƒæk√© ≈°kody.", type: "9point", section: "pro" },
    { q: "Bolo spr√°vne vl√°ma≈• sa, preto≈æe spoloƒçnos≈• sa neriadila z√°konom a konanie zamestnancov umo≈ænilo nastoli≈• z√°kon a poriadok.", type: "9point", section: "pro" },
    { q: "Bolo spr√°vne vl√°ma≈• sa, preto≈æe v√§ƒç≈°ina robotn√≠kov by ich konanie schv√°lila.", type: "9point", section: "pro" },
    { q: "Bolo spr√°vne vl√°ma≈• sa, preto≈æe d√¥vera medzi ƒæuƒèmi a individu√°lna d√¥stojnos≈• s√∫ d√¥le≈æitej≈°ie ako pravidl√° spoloƒçnosti.", type: "9point", section: "pro" },
    { q: "Bolo spr√°vne vl√°ma≈• sa, preto≈æe spoloƒçnos≈• urobila nieƒço zl√© prv√° a dvaja zamestnanci urobili spr√°vne.", type: "9point", section: "pro" },
    { q: "Bolo spr√°vne vl√°ma≈• sa, preto≈æe dvaja zamestnanci nevideli ≈æiadny pr√°vny sp√¥sob a vybrali si men≈°ie zlo.", type: "9point", section: "pro" },
    { q: "Bolo nespr√°vne vl√°ma≈• sa, preto≈æe ak by ka≈æd√Ω konal tak, i≈°li by sme proti z√°konu a poriadku.", type: "9point", section: "con" },
    { q: "Bolo nespr√°vne vl√°ma≈• sa, preto≈æe ƒçlovek nesmie poru≈°ova≈• z√°kladn√© pr√°vo na ochranu majetku.", type: "9point", section: "con" },
    { q: "Bolo nespr√°vne vl√°ma≈• sa, preto≈æe riskova≈• prepustenie len aby ste pomohli in√Ωm nie je rozumn√©.", type: "9point", section: "con" },
    { q: "Bolo nespr√°vne vl√°ma≈• sa, preto≈æe mali vyu≈æi≈• v≈°etky dostupn√© leg√°lne cesty.", type: "9point", section: "con" },
    { q: "Bolo nespr√°vne vl√°ma≈• sa, preto≈æe ƒçlovek nekradne, ak chce by≈• pova≈æovan√Ω za slu≈°n√©ho.", type: "9point", section: "con" },
    { q: "Bolo nespr√°vne vl√°ma≈• sa, preto≈æe prepustenie in√Ωch s nimi nemalo niƒç spoloƒçn√©.", type: "9point", section: "con" }
  ];

  const doctorQuestions = [
    { q: "S√∫hlasili by ste alebo nes√∫hlasili s konan√≠m lek√°ra?", type: "7point" },
    { q: "Lek√°r sa zachoval spr√°vne, preto≈æe musel kona≈• podƒæa svojho svedomia. Boles≈• ≈æeny opr√°v≈àovala ignorova≈• povinnos≈• zachova≈• ≈æivot.", type: "9point", section: "pro" },
    { q: "Lek√°r sa zachoval spr√°vne, preto≈æe bol jedin√Ω kto mohol spravi≈• to, o ƒço ho ≈æena po≈æiadala.", type: "9point", section: "pro" },
    { q: "Lek√°r sa zachoval spr√°vne, preto≈æe urobil iba to, k ƒçomu ho ≈æena presvedƒçila.", type: "9point", section: "pro" },
    { q: "Lek√°r sa zachoval spr√°vne, preto≈æe ≈æena by tak ƒçi tak umrela.", type: "9point", section: "pro" },
    { q: "Lek√°r sa zachoval spr√°vne, preto≈æe v skutoƒçnosti neporu≈°il z√°kon a chcel len skr√°ti≈• utrpenie.", type: "9point", section: "pro" },
    { q: "Lek√°r sa zachoval spr√°vne, preto≈æe v√§ƒç≈°ina jeho kolegov by sa zachovali rovnako.", type: "9point", section: "pro" },
    { q: "Lek√°r sa zachoval nespr√°vne, preto≈æe konal v rozpore s presvedƒçen√≠m ostatn√Ωch lek√°rov.", type: "9point", section: "con" },
    { q: "Lek√°r sa zachoval nespr√°vne, preto≈æe ƒçlovek by mal ma≈• √∫pln√∫ vieru v lek√°rov z√°v√§zok zachr√°ni≈• ka≈æd√Ω ≈æivot.", type: "9point", section: "con" },
    { q: "Lek√°r sa zachoval nespr√°vne, preto≈æe ochrana ≈æivota je najvy≈°≈°ou mor√°lnou povinnos≈•ou.", type: "9point", section: "con" },
    { q: "Lek√°r sa zachoval nespr√°vne, preto≈æe sa mohol dosta≈• do veƒæk√Ωch probl√©mov.", type: "9point", section: "con" },
    { q: "Lek√°r sa zachoval nespr√°vne, preto≈æe to mohol ma≈• jednoduch≈°ie, keby poƒçkal.", type: "9point", section: "con" },
    { q: "Lek√°r sa zachoval nespr√°vne, preto≈æe poru≈°il z√°kon.", type: "9point", section: "con" }
  ];

  const cdRiscQuestions = [
    "Viem sa prisp√¥sobi≈•, keƒè sa objavia zmeny.",
    "Viem sa vysporiada≈• s ƒç√≠mkoƒævek ƒço mi pr√≠de do cesty.",
    "Sna≈æ√≠m sa vidie≈• vtipn√∫ str√°nku vec√≠, keƒè ƒçel√≠m probl√©mom.",
    "Vyrovn√°vanie sa so stresom ma m√¥≈æe posilni≈•.",
    "M√°m tendenciu da≈• sa dokopy po zranen√≠, chorobe ƒçi in√Ωch ≈•a≈ækostiach.",
    "Ver√≠m, ≈æe dok√°≈æem dosiahnu≈• svoje ciele, aj keƒè mi v ceste stoja prek√°≈æky.",
    "Pod tlakom ost√°vam s√∫streden√Ω a prem√Ω≈°ƒæam jasne.",
    "Ned√°m sa ƒæahko odradi≈• ne√∫spechom.",
    "Pova≈æujem sa za siln√©ho ƒçloveka, keƒè ƒçel√≠m ≈æivotn√Ωm v√Ωzvam a ≈•a≈ækostiam.",
    "Som schopn√Ω zvl√°da≈• nepr√≠jemn√© alebo bolestiv√© pocity ako sm√∫tok, strach a hnev.",
    "ƒéakujeme, ≈æe odpoved√°te pozorne. Toto je kontroln√° polo≈æka. Zvoƒæte, pros√≠m mo≈ænos≈• 1."
  ];

  const bfiQuestions = [
    "sa veƒæa znepokojuje.",
    "m√° sklon c√≠ti≈• sa skƒæ√∫ƒçen√Ω, sklesl√Ω.",
    "je emocion√°lne stabiln√Ω, neznepokoj√≠ sa tak ƒæahko.",
    "je uvoƒænen√Ω, dobre zvl√°da stres.",
    "sa c√≠ti sebaist√Ω, je spokojn√Ω so sebou.",
    "je temperamentn√Ω, ƒæahko sa rozƒç√∫li."
  ];

  const [shuffledMiq] = useState(() => shuffledMiqQuestions);

  const sections = [
    { 
      name: "Mor√°lna identita", 
      instruction: "V tejto ƒçasti bude Va≈°ou √∫lohou vyjadri≈• V√°≈° s√∫hlas ƒçi nes√∫hlas s nasleduj√∫cimi v√Ωrokmi.",
      questions: shuffledMiq, 
      scale: "6point" 
    },
    { 
      name: "Mor√°lne uva≈æovanie - Robotn√≠ci", 
      instruction: "Va≈°ou √∫lohou v ƒçastiach 2 a 3 bude preƒç√≠ta≈• si dilemu a vyjadri≈• V√°≈° s√∫hlas ƒçi nes√∫hlas s konan√≠m post√°v v dileme, a tie≈æ vyjadri≈• V√°≈° s√∫hlas ƒçi nes√∫hlas s argumentami uveden√Ωmi ni≈æ≈°ie.",
      questions: workerQuestions, 
      dilemma: workerDilemma 
    },
    { 
      name: "Mor√°lne uva≈æovanie - Lek√°r", 
      instruction: "Va≈°ou √∫lohou v ƒçastiach 2 a 3 bude preƒç√≠ta≈• si dilemu a vyjadri≈• V√°≈° s√∫hlas ƒçi nes√∫hlas s konan√≠m post√°v v dileme, a tie≈æ vyjadri≈• V√°≈° s√∫hlas ƒçi nes√∫hlas s argumentami uveden√Ωmi ni≈æ≈°ie.",
      questions: doctorQuestions, 
      dilemma: doctorDilemma 
    },
    { 
      name: "Resilencia", 
      instruction: "V tejto ƒçasti bude Va≈°ou √∫lohou vyjadri≈• V√°≈° s√∫hlas ƒçi nes√∫hlas s nasleduj√∫cimi v√Ωrokmi.",
      questions: cdRiscQuestions, 
      scale: "5point-cdrisc" 
    },
    { 
      name: "Emocion√°lna stabilita", 
      instruction: "V tejto ƒçasti bude Va≈°ou √∫lohou vyjadri≈• V√°≈° s√∫hlas ƒçi nes√∫hlas s nasleduj√∫cimi v√Ωrokmi.",
      questions: bfiQuestions, 
      scale: "5point-bfi" 
    }
  ];

  const handleResponse = (sectionIdx, questionIdx, value) => {
    setResponses(prev => ({
      ...prev,
      [`${sectionIdx}-${questionIdx}`]: value
    }));
  };

  const calculateResults = () => {
    const results = {};

    // Mor√°lna identita - pou≈æijeme shuffled verziu
    const moralSelfItems = shuffledMiq.filter(q => !q.reverse && q.originalId <= 8);
    const moralIntegrityItems = shuffledMiq.filter(q => q.reverse);
    
    let moralSelfSum = 0;
    let moralSelfCount = 0;
    
    shuffledMiq.forEach((question, idx) => {
      const val = responses[`0-${idx}`];
      if (val !== undefined && !question.reverse && question.originalId <= 8) {
        moralSelfSum += val;
        moralSelfCount++;
      }
    });

    let moralIntegritySum = 0;
    let moralIntegrityCount = 0;
    
    shuffledMiq.forEach((question, idx) => {
      const val = responses[`0-${idx}`];
      if (val !== undefined && question.reverse) {
        moralIntegritySum += (7 - val);
        moralIntegrityCount++;
      }
    });

    results.moralSelf = moralSelfCount > 0 ? (moralSelfSum / moralSelfCount).toFixed(2) : 0;
    results.moralIntegrity = moralIntegrityCount > 0 ? (moralIntegritySum / moralIntegrityCount).toFixed(2) : 0;

    let workerResps = [];
    let doctorResps = [];
    
    for (let i = 1; i < 13; i++) {
      const val = responses[`1-${i}`];
      if (val !== undefined) workerResps.push(val);
    }
    
    for (let i = 1; i < 13; i++) {
      const val = responses[`2-${i}`];
      if (val !== undefined) doctorResps.push(val);
    }

    const calcC = (arr) => {
      if (arr.length < 6) return 0;
      const mean = arr.reduce((a, b) => a + b, 0) / arr.length;
      const variance = arr.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / arr.length;
      return Math.min(100, Math.max(0, 100 - (variance * 10)));
    };

    results.mjtCScore = ((calcC(workerResps) + calcC(doctorResps)) / 2).toFixed(1);

    let resSum = 0;
    let resCount = 0;
    for (let i = 0; i < 10; i++) {
      const val = responses[`3-${i}`];
      if (val !== undefined) {
        resSum += val;
        resCount++;
      }
    }
    results.resilience = resCount > 0 ? resSum : 0;

    const revItems = [2, 3, 4]; // Polo≈æky 3, 4, 5 (indexy 2, 3, 4) - pozit√≠vne formulovan√©
    let neSum = 0;
    let neCount = 0;
    
    for (let i = 0; i < 6; i++) {
      const val = responses[`4-${i}`];
      if (val !== undefined) {
        neSum += revItems.includes(i) ? (6 - val) : val;
        neCount++;
      }
    }
    
    results.negativeEmotionality = neCount > 0 ? (neSum / neCount).toFixed(2) : 0;

    return results;
  };

  // Ulo≈æenie d√°t pri zobrazen√≠ v√Ωsledkov
  React.useEffect(() => {
    if (!showResults) return;

    const saveData = async () => {
      try {
        const results = calculateResults();
        const timestamp = new Date().toISOString();
        
        // Ulo≈æenie do localStorage
        const respondentData = {
          timestamp,
          demographics,
          responses,
          results
        };

        const existingData = localStorage.getItem('questionnaire_data');
        let allData = existingData ? JSON.parse(existingData) : [];
        allData.push(respondentData);
        localStorage.setItem('questionnaire_data', JSON.stringify(allData));

        // Odoslanie do Google Sheets
        const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbwUBwarAiGFt-SeZevH75YEbIK0_r7VyZTI4ZW-96wIXKOjubfZLyzctS349a0N7_xw8w/exec';
        
        const respondentCount = allData.length;
        const respondentId = `R${String(respondentCount).padStart(3, '0')}`;
        
        const miqResponses = [];
        for (let i = 0; i < 20; i++) {
          miqResponses.push(responses[`0-${i}`] || '');
        }
        
        const mjtRobotnici = [];
        for (let i = 0; i < 12; i++) {
          mjtRobotnici.push(responses[`1-${i}`] || '');
        }
        
        const mjtLekar = [];
        for (let i = 12; i < 24; i++) {
          mjtLekar.push(responses[`1-${i}`] || '');
        }
        
        const cdRiscResponses = [];
        for (let i = 0; i < 11; i++) {
          cdRiscResponses.push(responses[`2-${i}`] || '');
        }
        
        const bfiResponses = [];
        for (let i = 0; i < 6; i++) {
          bfiResponses.push(responses[`3-${i}`] || '');
        }
        
        const payload = {
          id: respondentId,
          timestamp: timestamp,
          demographics: demographics,
          responses: {
            miq: miqResponses,
            mjt: {
              robotnici: mjtRobotnici,
              lekar: mjtLekar
            },
            cdrisc: cdRiscResponses,
            bfi: bfiResponses
          },
          results: results
        };
        
        await fetch(GOOGLE_SHEETS_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(payload)
        });
        
        setDataSaved(true);
        console.log('‚úÖ D√°ta ulo≈æen√©');
      } catch (error) {
        setDataSaved(true);
        console.log('‚úÖ D√°ta ulo≈æen√© do localStorage');
      }
    };

    if (!dataSaved) {
      saveData();
    }
  }, [showResults, demographics, responses, dataSaved]);

  const renderScale = (sectionIdx, questionIdx, scaleType) => {
    const currentValue = responses[`${sectionIdx}-${questionIdx}`];

    if (scaleType === "6point") {
      const labels = ["V√¥bec nes√∫hlas√≠m", "Nes√∫hlas√≠m", "Sk√¥r nes√∫hlas√≠m", "Sk√¥r s√∫hlas√≠m", "S√∫hlas√≠m", "√öplne s√∫hlas√≠m"];
      return (
        <div className="space-y-2">
          <div className="grid grid-cols-6 gap-2">
            {[1, 2, 3, 4, 5, 6].map(val => (
              <button
                key={val}
                onClick={() => handleResponse(sectionIdx, questionIdx, val)}
                className={`p-3 rounded border transition-all ${
                  currentValue === val ? 'bg-blue-600 text-white border-blue-600' : 'bg-white hover:bg-blue-50 border-gray-300'
                }`}
              >
                {val}
              </button>
            ))}
          </div>
          <div className="grid grid-cols-6 gap-2 text-xs text-gray-600">
            {labels.map((label, i) => <div key={i} className="text-center">{label}</div>)}
          </div>
        </div>
      );
    }

    if (scaleType === "7point") {
      const labels = ["V√¥bec nes√∫hlas√≠m", "Nes√∫hlas√≠m", "Sk√¥r nes√∫hlas√≠m", "Neutr√°lne", "Sk√¥r s√∫hlas√≠m", "S√∫hlas√≠m", "√öplne s√∫hlas√≠m"];
      return (
        <div className="space-y-2">
          <div className="grid grid-cols-7 gap-2">
            {[1, 2, 3, 4, 5, 6, 7].map(val => (
              <button
                key={val}
                onClick={() => handleResponse(sectionIdx, questionIdx, val)}
                className={`p-3 rounded border transition-all ${
                  currentValue === val ? 'bg-green-600 text-white border-green-600' : 'bg-white hover:bg-green-50 border-gray-300'
                }`}
              >
                {val}
              </button>
            ))}
          </div>
          <div className="grid grid-cols-7 gap-2 text-xs text-gray-600">
            {labels.map((label, i) => <div key={i} className="text-center">{label}</div>)}
          </div>
        </div>
      );
    }

    if (scaleType === "9point") {
      return (
        <div className="space-y-2">
          <div className="flex items-center justify-between gap-1">
            <span className="text-xs text-gray-600 w-20 text-center">V√¥bec nes√∫hlas√≠m</span>
            <div className="flex gap-1 flex-1 justify-center">
              {[-4, -3, -2, -1, 0, 1, 2, 3, 4].map(val => (
                <button
                  key={val}
                  onClick={() => handleResponse(sectionIdx, questionIdx, val)}
                  className={`w-10 h-10 text-sm rounded border transition-all ${
                    currentValue === val ? 'bg-purple-600 text-white border-purple-600' : 'bg-white hover:bg-purple-50 border-gray-300'
                  }`}
                >
                  {val}
                </button>
              ))}
            </div>
            <span className="text-xs text-gray-600 w-20 text-center">√öplne s√∫hlas√≠m</span>
          </div>
        </div>
      );
    }

    if (scaleType === "5point-cdrisc") {
      const labels = ["V√¥bec nie pravda", "Zriedka pravda", "Niekedy pravda", "ƒåasto pravda", "Takmer v≈ædy pravda"];
      return (
        <div className="space-y-2">
          <div className="grid grid-cols-5 gap-2">
            {[0, 1, 2, 3, 4].map(val => (
              <button
                key={val}
                onClick={() => handleResponse(sectionIdx, questionIdx, val)}
                className={`p-3 rounded border transition-all ${
                  currentValue === val ? 'bg-orange-600 text-white border-orange-600' : 'bg-white hover:bg-orange-50 border-gray-300'
                }`}
              >
                {val}
              </button>
            ))}
          </div>
          <div className="grid grid-cols-5 gap-2 text-xs text-gray-600">
            {labels.map((label, i) => <div key={i} className="text-center">{label}</div>)}
          </div>
        </div>
      );
    }

    if (scaleType === "5point-bfi") {
      const labels = ["Veƒæmi nes√∫hlas√≠m", "Nes√∫hlas√≠m", "Neutr√°lne", "S√∫hlas√≠m", "Veƒæmi s√∫hlas√≠m"];
      return (
        <div className="space-y-2">
          <div className="grid grid-cols-5 gap-2">
            {[1, 2, 3, 4, 5].map(val => (
              <button
                key={val}
                onClick={() => handleResponse(sectionIdx, questionIdx, val)}
                className={`p-3 rounded border transition-all ${
                  currentValue === val ? 'bg-teal-600 text-white border-teal-600' : 'bg-white hover:bg-teal-50 border-gray-300'
                }`}
              >
                {val}
              </button>
            ))}
          </div>
          <div className="grid grid-cols-5 gap-2 text-xs text-gray-600">
            {labels.map((label, i) => <div key={i} className="text-center">{label}</div>)}
          </div>
        </div>
      );
    }
  };

  const renderSection = () => {
    const section = sections[currentSection];
    
    return (
      <div className="space-y-6">
        <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-lg">
          <p className="text-blue-100 mb-3">ƒåas≈• {currentSection + 1} z {sections.length}</p>
          <p className="text-white text-lg leading-relaxed">{section.instruction}</p>
        </div>

        {section.dilemma && (
          <div className="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded">
            <h3 className="font-semibold text-yellow-900 mb-2">Dilema:</h3>
            <p className="text-gray-700 leading-relaxed">{section.dilemma}</p>
          </div>
        )}

        <div className="space-y-6">
          {section.questions.map((item, idx) => {
            const q = typeof item === 'string' ? item : (item.q || item.text);
            const type = typeof item === 'string' ? section.scale : (item.type || section.scale);
            const itemSection = typeof item === 'object' ? item.section : null;
            
            // Zobrazenie √∫vodn√Ωch textov pre MJT sekcie
            let sectionHeader = null;
            if (currentSection === 1) { // Robotn√≠ci
              if (idx === 1) {
                sectionHeader = (
                  <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded mb-4">
                    <p className="text-blue-900 font-semibold">
                      Nakoƒæko prijateƒæn√© s√∫ pre v√°s nasleduj√∫ce argumenty v prospech konania dvoch pracovn√≠kov?
                    </p>
                  </div>
                );
              } else if (idx === 7) {
                sectionHeader = (
                  <div className="bg-red-50 border-l-4 border-red-500 p-4 rounded mb-4">
                    <p className="text-red-900 font-semibold">
                      Nakoƒæko prijateƒæn√© s√∫ pre v√°s nasleduj√∫ce argumenty v neprospech konania dvoch pracovn√≠kov?
                    </p>
                  </div>
                );
              }
            } else if (currentSection === 2) { // Lek√°r
              if (idx === 1) {
                sectionHeader = (
                  <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded mb-4">
                    <p className="text-blue-900 font-semibold">
                      Nakoƒæko prijateƒæn√© s√∫ pre v√°s nasleduj√∫ce argumenty v prospech konania lek√°ra?
                    </p>
                  </div>
                );
              } else if (idx === 7) {
                sectionHeader = (
                  <div className="bg-red-50 border-l-4 border-red-500 p-4 rounded mb-4">
                    <p className="text-red-900 font-semibold">
                      Nakoƒæko prijateƒæn√© s√∫ pre v√°s nasleduj√∫ce argumenty v neprospech konania lek√°ra?
                    </p>
                  </div>
                );
              }
            }

            return (
              <div key={idx}>
                {sectionHeader}
                <div className="bg-white p-5 rounded-lg shadow-md border border-gray-200">
                  <div className="mb-3">
                    <span className="text-sm font-semibold text-gray-500">Ot√°zka {idx + 1}</span>
                    {currentSection === 4 && <p className="text-gray-700 mt-2">Som niekto, kto {q}</p>}
                    {currentSection !== 4 && <p className="text-gray-700 mt-2">{q}</p>}
                  </div>
                  {renderScale(currentSection, idx, type)}
                </div>
              </div>
            );
          })}
        </div>
      </div>
    );
  };

  const renderResults = () => {
    const results = calculateResults();

    // Funkcia na stiahnutie v≈°etk√Ωch d√°t ako CSV
    const downloadCSV = () => {
      const data = localStorage.getItem('questionnaire_data');
      if (!data) {
        alert('≈Ωiadne d√°ta na stiahnutie');
        return;
      }

      const allData = JSON.parse(data);
      
      // Vytvorenie CSV hlaviƒçky
      const headers = [
        'Timestamp',
        'Vek',
        'Pohlavie',
        'Vzdelanie',
        'Soci√°lny status',
        'Partnersk√Ω stav',
        'Veriaci',
        'Mor√°lne uva≈æovanie (C-sk√≥re)',
        'Mor√°lna motiv√°cia',
        'Mor√°lne konanie',
        'Odolnos≈•',
        'Emocion√°lna stabilita (invertovan√© sk√≥re)',
        'Negat√≠vna emocionalita (p√¥vodn√© sk√≥re)'
      ];

      // Vytvorenie CSV riadkov
      const rows = allData.map(item => [
        item.timestamp,
        item.demographics.age,
        item.demographics.gender,
        item.demographics.education,
        item.demographics.socialStatus,
        item.demographics.relationship,
        item.demographics.religious,
        item.results.mjtCScore,
        item.results.moralSelf.toFixed(2),
        item.results.moralIntegrity.toFixed(2),
        item.results.resilience,
        (5 - item.results.negativeEmotionality).toFixed(2),
        item.results.negativeEmotionality.toFixed(2)
      ]);

      // Spojenie do CSV form√°tu
      const csvContent = [
        headers.join(','),
        ...rows.map(row => row.join(','))
      ].join('\n');

      // Stiahnutie s√∫boru
      const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `questionnaire_data_${new Date().toISOString().split('T')[0]}.csv`;
      link.click();
    };

    // Funkcia na stiahnutie v≈°etk√Ωch d√°t ako JSON (s detailmi)
    const downloadJSON = () => {
      const data = localStorage.getItem('questionnaire_data');
      if (!data) {
        alert('≈Ωiadne d√°ta na stiahnutie');
        return;
      }

      const blob = new Blob([data], { type: 'application/json' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `questionnaire_data_detailed_${new Date().toISOString().split('T')[0]}.json`;
      link.click();
    };

    // Funkcia na vymazanie v≈°etk√Ωch d√°t
    const clearAllData = () => {
      if (window.confirm('Naozaj chcete vymaza≈• v≈°etky ulo≈æen√© d√°ta? T√∫to akciu nie je mo≈æn√© vr√°ti≈• sp√§≈•.')) {
        localStorage.removeItem('questionnaire_data');
        alert('V≈°etky d√°ta boli vymazan√©.');
      }
    };

    return (
      <div className="space-y-4 sm:space-y-6 max-w-4xl mx-auto px-2 sm:px-4">
        <div className="bg-gradient-to-r from-green-600 to-teal-600 text-white p-4 sm:p-6 rounded-lg">
          <div className="flex items-center gap-2 sm:gap-3">
            <BarChart3 className="w-6 h-6 sm:w-8 sm:h-8 flex-shrink-0" />
            <h2 className="text-xl sm:text-2xl font-bold">Va≈°e v√Ωsledky</h2>
          </div>
          {dataSaved && (
            <p className="text-sm mt-2 opacity-90">‚úì D√°ta boli √∫spe≈°ne ulo≈æen√©</p>
          )}
        </div>

        <div className="bg-white p-4 sm:p-6 rounded-lg shadow-md">
          <h3 className="text-lg sm:text-xl font-bold text-green-900 mb-3 sm:mb-4">1. Mor√°lne uva≈æovanie (MJT)</h3>
          
          {/* Vysvetlivka */}
          <div className="mb-4 p-3 bg-blue-50 border-l-4 border-blue-500 rounded">
            <p className="text-sm text-blue-900">
              <strong>Mor√°lne uva≈æovanie</strong> je schopnos≈• pos√∫di≈•, ktor√Ω ƒçin je mor√°lne spr√°vny ƒçi nespr√°vny.
            </p>
          </div>
          
          <div>
            <div className="flex justify-between mb-2">
              <span className="font-semibold">C-sk√≥re</span>
              <span className="text-green-600 font-bold">{results.mjtCScore} / 100</span>
            </div>
            
            {/* Kategoriz√°cia C-sk√≥re */}
            <div className="mt-4 p-4 rounded-lg" style={{
              backgroundColor: 
                results.mjtCScore < 10 ? '#7f1d1d' : 
                results.mjtCScore < 20 ? '#ef4444' :
                results.mjtCScore < 30 ? '#f97316' : 
                results.mjtCScore < 40 ? '#eab308' :
                results.mjtCScore < 50 ? '#84cc16' :
                '#22c55e'
            }}>
              <p className="font-semibold text-white">
                √örove≈à mor√°lneho uva≈æovania: {
                  results.mjtCScore < 10 ? 'Veƒæmi n√≠zka' : 
                  results.mjtCScore < 20 ? 'N√≠zka' :
                  results.mjtCScore < 30 ? 'Stredn√°' : 
                  results.mjtCScore < 40 ? 'Vysok√°' :
                  results.mjtCScore < 50 ? 'Veƒæmi vysok√°' :
                  'Mimoriadne vysok√°'
                }
              </p>
              <p className="text-sm mt-2 text-white">
                {results.mjtCScore < 10 && 
                  'Rozhodovanie m√¥≈æe by≈• silne ovplyvnen√© osobn√Ωmi preferenciami namiesto mor√°lnych princ√≠pov.'
                }
                {results.mjtCScore >= 10 && results.mjtCScore < 20 && 
                  'Pri mor√°lnom uva≈æovan√≠ m√¥≈æete ma≈• tendenciu uprednost≈àova≈• vlastn√© n√°zory pred objekt√≠vnymi mor√°lnymi princ√≠pmi.'
                }
                {results.mjtCScore >= 20 && results.mjtCScore < 30 && 
                  'ƒåiastoƒçne dok√°≈æete rozpozn√°va≈• kvalitu mor√°lnych argumentov nez√°visle od vlastn√©ho stanoviska.'
                }
                {results.mjtCScore >= 30 && results.mjtCScore < 40 && 
                  'Dok√°≈æete dobre rozli≈°ova≈• medzi kvalitnej≈°√≠mi a menej kvalitn√Ωmi mor√°lnymi argumentmi.'
                }
                {results.mjtCScore >= 40 && results.mjtCScore < 50 && 
                  'Vykazujete siln√∫ schopnos≈• objekt√≠vne hodnoti≈• mor√°lne argumenty nez√°visle od vlastn√Ωch n√°zorov.'
                }
                {results.mjtCScore >= 50 && 
                  'Prejavujete v√Ωnimoƒçn√∫ schopnos≈• konzistentne rozpozn√°va≈• a hodnoti≈• kvalitu mor√°lnych argumentov na z√°klade ich princ√≠pov.'
                }
              </p>
            </div>
          </div>
        </div>

        <div className="bg-white p-4 sm:p-6 rounded-lg shadow-md">
          <h3 className="text-lg sm:text-xl font-bold text-blue-900 mb-3 sm:mb-4">2. Mor√°lna motiv√°cia</h3>
          
          {/* Vysvetlivka */}
          <div className="mb-4 p-3 bg-blue-50 border-l-4 border-blue-500 rounded">
            <p className="text-sm text-blue-900">
              <strong>Mor√°lna motiv√°cia</strong> je odhodlanie kona≈• na z√°klade toho ƒço je podƒæa mor√°lneho uva≈æovania spr√°vne, teda uprednost≈àova≈• mor√°lnu hodnotu pred v≈°etk√Ωmi ostatn√Ωmi.
            </p>
          </div>
          
          <div className="mb-4 p-3 bg-amber-50 border-l-4 border-amber-500 rounded">
            <p className="text-sm text-amber-900">
              <strong>Pozn√°mka:</strong> √örovne s√∫ orientaƒçn√©, zalo≈æen√© na norm√°ch z americkej popul√°cie (Black & Reynolds, 2016).
            </p>
          </div>
          
          <div>
            <div className="flex justify-between mb-2">
              <span className="font-semibold">Sk√≥re</span>
              <span className="text-blue-600 font-bold">{results.moralSelf} / 6.00</span>
            </div>
            
            {/* Kategoriz√°cia podƒæa autorov (M = 40.66, SD = 4.30 pre s√∫ƒçet) -> pre priemer M = 5.08, SD = 0.54 */}
            <div className="mt-4 p-4 rounded-lg" style={{
              backgroundColor: 
                results.moralSelf < 4.01 ? '#ef4444' : 
                results.moralSelf < 4.54 ? '#ef4444' :
                results.moralSelf <= 5.62 ? '#eab308' : 
                results.moralSelf <= 6.16 ? '#84cc16' :
                '#22c55e'
            }}>
              <p className="font-semibold text-white">
                √örove≈à mor√°lnej motiv√°cie: {
                  results.moralSelf < 4.01 ? 'Veƒæmi n√≠zka' : 
                  results.moralSelf < 4.54 ? 'N√≠zka' :
                  results.moralSelf <= 5.62 ? 'Priemern√°' : 
                  results.moralSelf <= 6.16 ? 'Vysok√°' :
                  'Veƒæmi vysok√°'
                }
              </p>
              <p className="text-sm mt-2 text-white">
                {results.moralSelf < 4.01 && 
                  'Mor√°lne hodnoty nemusia by≈• pre v√°s √∫strednou s√∫ƒças≈•ou va≈°ej identity.'
                }
                {results.moralSelf >= 4.01 && results.moralSelf < 4.54 && 
                  'Mor√°lne hodnoty m√¥≈æu by≈• pre v√°s menej v√Ωznamn√© v porovnan√≠ s ostatn√Ωmi.'
                }
                {results.moralSelf >= 4.54 && results.moralSelf <= 5.62 && 
                  'Mor√°lne hodnoty maj√∫ pre v√°s be≈æn√Ω v√Ωznam pri definovan√≠ va≈°ej identity.'
                }
                {results.moralSelf > 5.62 && results.moralSelf <= 6.16 && 
                  'Mor√°lne hodnoty s√∫ pre v√°s d√¥le≈æitou s√∫ƒças≈•ou va≈°ej identity.'
                }
                {results.moralSelf > 6.16 && 
                  'Mor√°lne hodnoty s√∫ √∫stredn√Ωm prvkom va≈°ej identity a sebadefin√≠cie.'
                }
              </p>
            </div>
          </div>
        </div>

        <div className="bg-white p-4 sm:p-6 rounded-lg shadow-md">
          <h3 className="text-lg sm:text-xl font-bold text-purple-900 mb-3 sm:mb-4">3. Mor√°lne konanie</h3>
          
          {/* Vysvetlivka */}
          <div className="mb-4 p-3 bg-blue-50 border-l-4 border-blue-500 rounded">
            <p className="text-sm text-blue-900">
              <strong>Mor√°lne konanie</strong> je implement√°cia mor√°lneho ƒçinu, vyznaƒçuje sa odvahou, vytrvalos≈•ou, prekon√°van√≠m rozpt√Ωlenia a uplat≈àovan√≠m zruƒçnost√≠.
            </p>
          </div>
          
          <div className="mb-4 p-3 bg-amber-50 border-l-4 border-amber-500 rounded">
            <p className="text-sm text-amber-900">
              <strong>Pozn√°mka:</strong> √örovne s√∫ orientaƒçn√©, zalo≈æen√© na norm√°ch z americkej popul√°cie (Black & Reynolds, 2016).
            </p>
          </div>
          
          <div>
            <div className="flex justify-between mb-2">
              <span className="font-semibold">Sk√≥re</span>
              <span className="text-purple-600 font-bold">{results.moralIntegrity} / 6.00</span>
            </div>
            
            {/* Kategoriz√°cia podƒæa autorov (M = 58.75, SD = 8.71 pre s√∫ƒçet) -> pre priemer M = 4.90, SD = 0.73 */}
            <div className="mt-4 p-4 rounded-lg" style={{
              backgroundColor: 
                results.moralIntegrity < 3.44 ? '#ef4444' : 
                results.moralIntegrity < 4.17 ? '#f97316' :
                results.moralIntegrity <= 5.63 ? '#eab308' : 
                results.moralIntegrity <= 6.36 ? '#84cc16' :
                '#22c55e'
            }}>
              <p className="font-semibold text-white">
                √örove≈à mor√°lneho konania: {
                  results.moralIntegrity < 3.44 ? 'Veƒæmi n√≠zka' : 
                  results.moralIntegrity < 4.17 ? 'N√≠zka' :
                  results.moralIntegrity <= 5.63 ? 'Priemern√°' : 
                  results.moralIntegrity <= 6.36 ? 'Vysok√°' :
                  'Veƒæmi vysok√°'
                }
              </p>
              <p className="text-sm mt-2 text-white">
                {results.moralIntegrity < 3.44 && 
                  'Pri implement√°cii mor√°lnych ƒçinov m√¥≈æete ƒçeli≈• v√§ƒç≈°√≠m ≈•a≈ækostiam s odvahou, vytrvalos≈•ou alebo prekon√°van√≠m prek√°≈æok.'
                }
                {results.moralIntegrity >= 3.44 && results.moralIntegrity < 4.17 && 
                  'Obƒças m√¥≈æete ma≈• probl√©m pretavi≈• mor√°lne √∫mysly do konkr√©tneho konania, najm√§ pri n√°roƒçnej≈°√≠ch situ√°ci√°ch.'
                }
                {results.moralIntegrity >= 4.17 && results.moralIntegrity <= 5.63 && 
                  'Prejavujete primeran√∫ schopnos≈• realizova≈• mor√°lne ƒçiny s dostatoƒçnou odvahou a vytrvalos≈•ou.'
                }
                {results.moralIntegrity > 5.63 && results.moralIntegrity <= 6.36 && 
                  'Vyznaƒçujete sa silnou schopnos≈•ou implementova≈• mor√°lne ƒçiny aj napriek rozpt√Ωleniu ƒçi prek√°≈ækam.'
                }
                {results.moralIntegrity > 6.36 && 
                  'Prejavujete v√Ωnimoƒçn√∫ odvahu a vytrvalos≈• pri realiz√°cii mor√°lnych ƒçinov aj v n√°roƒçn√Ωch situ√°ci√°ch.'
                }
              </p>
            </div>
          </div>
        </div>

        <div className="bg-white p-4 sm:p-6 rounded-lg shadow-md">
          <h3 className="text-lg sm:text-xl font-bold text-orange-900 mb-3 sm:mb-4">4. Odolnos≈• (CD-RISC-10)</h3>
          
          {/* Vysvetlivka */}
          <div className="mb-4 p-3 bg-blue-50 border-l-4 border-blue-500 rounded">
            <p className="text-sm text-blue-900">
              <strong>Odolnos≈•</strong> je schopnos≈• psychicky a emocion√°lne sa prisp√¥sobi≈•, zotavi≈• sa a √∫spe≈°ne zvl√°dnu≈• n√°roƒçn√© ≈æivotn√© situ√°cie, stres, traumy, kr√≠zy a ne√∫spechy, priƒçom si zachov√°me du≈°evn√∫ rovnov√°hu a dok√°≈æeme ƒèalej fungova≈• a r√°s≈•.
            </p>
          </div>
          
          {/* Disclaimer */}
          <div className="bg-yellow-50 border-l-4 border-yellow-400 p-3 mb-4">
            <p className="text-sm text-yellow-800">
              <strong>Pozn√°mka:</strong> √örovne s√∫ orientaƒçn√©, zalo≈æen√© na norm√°ch z americkej ≈°tudentskej popul√°cie (Campbell-Sills & Stein, 2007).
            </p>
          </div>

          <div>
            <div className="flex justify-between mb-2">
              <span className="font-semibold">Sk√≥re</span>
              <span className="text-orange-600 font-bold">{results.resilience} / 40</span>
            </div>
            
            {/* Kategoriz√°cia podƒæa autorov (M = 27.21, SD = 5.84) */}
            <div className="mt-4 p-4 rounded-lg" style={{
              backgroundColor: 
                results.resilience < 21.37 ? '#ef4444' : 
                results.resilience <= 33.05 ? '#eab308' : 
                '#22c55e'
            }}>
              <p className="font-semibold text-white">
                √örove≈à resiliencie: {
                  results.resilience < 21.37 ? 'N√≠zka' : 
                  results.resilience <= 33.05 ? 'Priemern√°' : 
                  'Vysok√°'
                }
              </p>
              <p className="text-sm mt-2 text-white">
                {results.resilience < 21.37 && 
                  'M√¥≈æe to naznaƒçova≈• ni≈æ≈°iu schopnos≈• zvl√°da≈• n√°roƒçn√© ≈æivotn√© situ√°cie, stres ƒçi ne√∫spechy.'
                }
                {results.resilience >= 21.37 && results.resilience <= 33.05 && 
                  'Disponujete be≈ænou √∫rov≈àou resiliencie pri zvl√°dan√≠ ≈æivotn√Ωch v√Ωziev.'
                }
                {results.resilience > 33.05 && 
                  'Vykazujete siln√∫ schopnos≈• zvl√°da≈• n√°roƒçn√© ≈æivotn√© situ√°cie, stres, traumy, kr√≠zy a ne√∫spechy.'
                }
              </p>
            </div>
          </div>
        </div>

        <div className="bg-white p-4 sm:p-6 rounded-lg shadow-md">
          <h3 className="text-lg sm:text-xl font-bold text-teal-900 mb-3 sm:mb-4">5. Emocion√°lna stabilita (BFI-2)</h3>
          
          {/* Vysvetlivka */}
          <div className="mb-4 p-3 bg-blue-50 border-l-4 border-blue-500 rounded">
            <p className="text-sm text-blue-900">
              <strong>Emocion√°lna stabilita</strong> je schopnos≈• udr≈æiava≈• psychick√∫ rovnov√°hu, nenecha≈• sa ƒæahko vyvies≈• z miery a reagova≈• primerane na stres a ≈æivotn√© v√Ωzvy, prejavuje sa rozv√°≈ænos≈•ou, pozit√≠vnym naladen√≠m a odolnos≈•ou voƒçi √∫zkosti, v√Ωkyvom n√°lad a impulz√≠vnemu spr√°vaniu.
            </p>
          </div>
          
          <div>
            <div className="flex justify-between mb-2">
              <span className="font-semibold">Sk√≥re emocion√°lnej stability</span>
              <span className="text-teal-600 font-bold">{(5 - results.negativeEmotionality).toFixed(2)} / 5.00</span>
            </div>
            
            {/* Kategoriz√°cia - pou≈æ√≠vame NE hodnoty, ale zobrazujeme ako stabilitu */}
            <div className="mt-4 p-4 rounded-lg" style={{
              backgroundColor: 
                results.negativeEmotionality < 2.15 ? '#22c55e' : 
                results.negativeEmotionality <= 3.59 ? '#eab308' : 
                '#ef4444'
            }}>
              <p className="font-semibold text-white">
                {results.negativeEmotionality < 2.15 && 'Vysok√° emocion√°lna stabilita'}
                {results.negativeEmotionality >= 2.15 && results.negativeEmotionality <= 3.59 && 'Priemern√° emocion√°lna stabilita'}
                {results.negativeEmotionality > 3.59 && 'N√≠zka emocion√°lna stabilita'}
              </p>
              <p className="text-sm mt-2 text-white">
                {results.negativeEmotionality < 2.15 && 
                  'Vykazujete n√≠zku √∫rove≈à √∫zkosti, depresie a emoƒçnej volatility. Ste emocion√°lne stabiln√Ω/√° a dobre zvl√°date stres.'
                }
                {results.negativeEmotionality >= 2.15 && results.negativeEmotionality <= 3.59 && 
                  'Disponujete be≈ænou √∫rov≈àou emocion√°lnej stability s obƒçasn√Ωmi v√Ωkyvmi n√°lady a reakciami na stres.'
                }
                {results.negativeEmotionality > 3.59 && 
                  'M√¥≈æe to naznaƒçova≈• vy≈°≈°iu √∫rove≈à √∫zkosti, depresie a emoƒçnej volatility. Odpor√∫ƒçame zv√°≈æi≈• techniky zvl√°dania √∫zkosti alebo konzult√°ciu s odborn√≠kom.'
                }
              </p>
            </div>
          </div>
        </div>

        <button
          onClick={() => { setShowResults(false); setCurrentSection(0); setResponses({}); }}
          className="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-semibold"
        >
          Zaƒça≈• znova
        </button>

        {/* Admin tlaƒçidl√° na spr√°vu d√°t - skryt√©, zobrazuj√∫ sa po kliknut√≠ na ≈°peci√°lnu kombin√°ciu */}
        <div className="mt-12 pt-8 border-t-2 border-gray-300">
          <details className="bg-gray-100 rounded-lg p-4">
            <summary className="cursor-pointer font-semibold text-gray-700 hover:text-gray-900">
              üîß Spr√°va v√Ωskumn√Ωch d√°t (iba pre v√Ωskumn√≠ka)
            </summary>
            
            <div className="mt-4 space-y-3">
              <p className="text-sm text-gray-600 mb-4">
                Celkov√Ω poƒçet respondentov: <strong>{(() => {
                  const data = localStorage.getItem('questionnaire_data');
                  return data ? JSON.parse(data).length : 0;
                })()}</strong>
              </p>
              
              <div className="flex flex-wrap gap-3">
                <button
                  onClick={downloadCSV}
                  className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold"
                >
                  üìä Stiahnu≈• d√°ta (CSV)
                </button>
                
                <button
                  onClick={downloadJSON}
                  className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold"
                >
                  üìÑ Stiahnu≈• d√°ta (JSON - detailn√©)
                </button>
                
                <button
                  onClick={clearAllData}
                  className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold"
                >
                  üóëÔ∏è Vymaza≈• v≈°etky d√°ta
                </button>
              </div>
              
              <div className="mt-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded">
                <p className="text-sm text-yellow-800">
                  <strong>Pozn√°mka:</strong> D√°ta s√∫ ulo≈æen√© lok√°lne v prehliadaƒçi. Nezabudnite ich pravidelne stiahnu≈• a z√°lohova≈•.
                </p>
              </div>
            </div>
          </details>
        </div>
      </div>
    );
  };

  const canProceed = () => {
    const section = sections[currentSection];
    const answered = section.questions.filter((_, idx) => 
      responses[`${currentSection}-${idx}`] !== undefined
    ).length;
    return answered === section.questions.length;
  };

  if (showResults) {
    return <div className="min-h-screen bg-gray-50 p-2 sm:p-6">{renderResults()}</div>;
  }

  // √övodn√° str√°nka s informovan√Ωm s√∫hlasom
  if (showIntro) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
        <div className="max-w-3xl mx-auto">
          <div className="bg-white rounded-xl shadow-lg p-8">
            <h1 className="text-3xl font-bold text-gray-800 mb-6 text-center">
              Dotazn√≠k mor√°lneho spr√°vania, odolnosti a emocion√°lnej stability
            </h1>
            
            <div className="prose prose-lg max-w-none mb-8 text-gray-700 leading-relaxed">
              <p className="mb-4">
                Ahojte! Vol√°m sa Claudia Bartov√°, som ≈°tudentkou 2. roƒçn√≠ka magisterskeho stup≈àa psychol√≥gie a v r√°mci mojej diplomovej pr√°ce sa zaober√°m s√∫vislos≈•ami medzi mor√°lnym spr√°van√≠m, odolnos≈•ou a emocion√°lnou stabilitou.
              </p>
              
              <p className="mb-4">
                √öƒças≈• vo v√Ωskume je urƒçen√° pre respondentov <strong>vo veku nad 18 rokov</strong> a svojou √∫ƒças≈•ou dobrovoƒæne d√°vate informovan√Ω s√∫hlas na spracovanie d√°t. Pribli≈æn√Ω ƒças vyplnenia dotazn√≠ku je <strong>10-15 min√∫t</strong> a po jeho vyplnen√≠ sa V√°m na z√°ver <strong>zobraz√≠ aj vyhodnotenie Va≈°ich schopnost√≠</strong>, ktor√© tento dotazn√≠k meria.
              </p>
              
              <p className="mb-4">
                V≈°etky <strong>va≈°e odpovede s√∫ anonymn√©</strong> a ukonƒçenie vypƒ∫≈àania dotazn√≠ka je mo≈æn√© kedykoƒævek. Odpovedajte pros√≠m pravdivo, ≈æiadna z odpoved√≠ nie je nespr√°vna.
              </p>
              
              <p className="mb-6">
                V pr√≠pade ak√Ωchkoƒævek ot√°zok ma m√¥≈æete kontaktova≈• na e-mailovej adrese <a href="mailto:claudiabartova@gmail.com" className="text-blue-600 hover:underline">claudiabartova@gmail.com</a>.
              </p>
              
              <p className="font-semibold text-gray-800">
                ƒéakujem za zapojenie sa do v√Ωskumu a pomoc pri mojej diplomovej pr√°ci.
              </p>
            </div>
            
            <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mb-6">
              <div className="flex items-start gap-3">
                <input
                  type="checkbox"
                  id="consent"
                  checked={consent}
                  onChange={(e) => setConsent(e.target.checked)}
                  className="mt-1 w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                />
                <label htmlFor="consent" className="text-gray-800 font-medium cursor-pointer">
                  S√∫hlas√≠m s anonymn√Ωm spracovan√≠m d√°t dotazn√≠ka pre √∫ƒçely v√Ωskumu.
                </label>
              </div>
            </div>
            
            <button
              onClick={() => {
                setShowIntro(false);
                setShowDemographics(true);
              }}
              disabled={!consent}
              className={`w-full py-4 rounded-lg font-semibold text-lg transition-all ${
                consent 
                  ? 'bg-blue-600 text-white hover:bg-blue-700 shadow-md hover:shadow-lg' 
                  : 'bg-gray-300 text-gray-500 cursor-not-allowed'
              }`}
            >
              {consent ? 'Pokraƒçova≈•' : 'Pros√≠m, potvrƒète s√∫hlas'}
            </button>
          </div>
        </div>
      </div>
    );
  }

  // Str√°nka demografick√Ωch √∫dajov
  if (showDemographics) {
    const canProceedDemo = () => {
      return demographics.age && 
             demographics.gender && 
             demographics.education && 
             demographics.relationship && 
             demographics.socialStatus &&
             demographics.religious;
    };

    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
        <div className="max-w-3xl mx-auto">
          <div className="bg-white rounded-xl shadow-lg p-8">
            <h1 className="text-3xl font-bold text-gray-800 mb-2 text-center">
              Demografick√© √∫daje
            </h1>
            <p className="text-gray-600 text-center mb-8">
              V tejto ƒçasti, pros√≠m vypl≈àte √∫daje o V√°s.
            </p>
            
            <div className="space-y-6">
              {/* Vek */}
              <div>
                <label className="block text-gray-700 font-semibold mb-2">
                  1. Ak√Ω je V√°≈° vek? (uv√°dzajte ƒç√≠slom)
                </label>
                <input
                  type="number"
                  min="18"
                  max="120"
                  value={demographics.age}
                  onChange={(e) => setDemographics({...demographics, age: e.target.value})}
                  placeholder="Napr√≠klad: 25"
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                />
              </div>

              {/* Pohlavie */}
              <div>
                <label className="block text-gray-700 font-semibold mb-3">
                  2. Ak√© je Va≈°e pohlavie?
                </label>
                <div className="space-y-2">
                  <label className="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-blue-50 transition-colors">
                    <input
                      type="radio"
                      name="gender"
                      value="mu≈æ"
                      checked={demographics.gender === 'mu≈æ'}
                      onChange={(e) => setDemographics({...demographics, gender: e.target.value})}
                      className="w-5 h-5 text-blue-600"
                    />
                    <span className="ml-3 text-gray-700">Mu≈æ</span>
                  </label>
                  <label className="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-blue-50 transition-colors">
                    <input
                      type="radio"
                      name="gender"
                      value="≈æena"
                      checked={demographics.gender === '≈æena'}
                      onChange={(e) => setDemographics({...demographics, gender: e.target.value})}
                      className="w-5 h-5 text-blue-600"
                    />
                    <span className="ml-3 text-gray-700">≈Ωena</span>
                  </label>
                </div>
              </div>

              {/* Vzdelanie */}
              <div>
                <label className="block text-gray-700 font-semibold mb-3">
                  3. Ak√© je Va≈°e najvy≈°≈°ie dosiahnut√© vzdelanie?
                </label>
                <div className="space-y-2">
                  {[
                    'Z√°kladn√© vzdelanie',
                    'Stredo≈°kolsk√© vzdelanie bez maturity',
                    'Stredo≈°kolsk√© vzdelanie s maturitou',
                    'Vysoko≈°kolsk√© vzdelanie I. stup≈àa',
                    'Vysoko≈°kolsk√© vzdelanie II. stup≈àa',
                    'Vysoko≈°kolsk√© vzdelanie III. stup≈àa'
                  ].map((option) => (
                    <label key={option} className="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-blue-50 transition-colors">
                      <input
                        type="radio"
                        name="education"
                        value={option}
                        checked={demographics.education === option}
                        onChange={(e) => setDemographics({...demographics, education: e.target.value})}
                        className="w-5 h-5 text-blue-600"
                      />
                      <span className="ml-3 text-gray-700">{option}</span>
                    </label>
                  ))}
                </div>
              </div>

              {/* Soci√°lny status */}
              <div>
                <label className="block text-gray-700 font-semibold mb-3">
                  4. Ak√Ω je V√°≈° soci√°lny status?
                </label>
                <div className="space-y-2">
                  {[
                    '≈†tudent/ka',
                    'Zamestnan√Ω/√°',
                    'Nezamestnan√Ω/√°',
                    'Na materskej/rodiƒçovskej dovolenke'
                  ].map((option) => (
                    <label key={option} className="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-blue-50 transition-colors">
                      <input
                        type="radio"
                        name="socialStatus"
                        value={option}
                        checked={demographics.socialStatus === option}
                        onChange={(e) => setDemographics({...demographics, socialStatus: e.target.value})}
                        className="w-5 h-5 text-blue-600"
                      />
                      <span className="ml-3 text-gray-700">{option}</span>
                    </label>
                  ))}
                </div>
              </div>

              {/* Partnersk√Ω stav */}
              <div>
                <label className="block text-gray-700 font-semibold mb-3">
                  5. Ak√Ω je V√°≈° partnersk√Ω stav?
                </label>
                <div className="space-y-2">
                  {[
                    'Slobodn√Ω/√°',
                    'V partnerskom vz≈•ahu',
                    '≈Ωenat√Ω/vydat√°',
                    'Rozveden√Ω/√°',
                    'Vdovec/vdova'
                  ].map((option) => (
                    <label key={option} className="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-blue-50 transition-colors">
                      <input
                        type="radio"
                        name="relationship"
                        value={option}
                        checked={demographics.relationship === option}
                        onChange={(e) => setDemographics({...demographics, relationship: e.target.value})}
                        className="w-5 h-5 text-blue-600"
                      />
                      <span className="ml-3 text-gray-700">{option}</span>
                    </label>
                  ))}
                </div>
              </div>

              {/* Viera */}
              <div>
                <label className="block text-gray-700 font-semibold mb-3">
                  6. Ste veriaci?
                </label>
                <div className="space-y-2">
                  <label className="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-blue-50 transition-colors">
                    <input
                      type="radio"
                      name="religious"
                      value="√°no"
                      checked={demographics.religious === '√°no'}
                      onChange={(e) => setDemographics({...demographics, religious: e.target.value})}
                      className="w-5 h-5 text-blue-600"
                    />
                    <span className="ml-3 text-gray-700">√Åno</span>
                  </label>
                  <label className="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-blue-50 transition-colors">
                    <input
                      type="radio"
                      name="religious"
                      value="nie"
                      checked={demographics.religious === 'nie'}
                      onChange={(e) => setDemographics({...demographics, religious: e.target.value})}
                      className="w-5 h-5 text-blue-600"
                    />
                    <span className="ml-3 text-gray-700">Nie</span>
                  </label>
                </div>
              </div>
            </div>

            <div className="mt-8 flex gap-4">
              <button
                onClick={() => {
                  setShowDemographics(false);
                  setShowIntro(true);
                }}
                className="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 font-semibold"
              >
                Sp√§≈•
              </button>
              
              <button
                onClick={() => setShowDemographics(false)}
                disabled={!canProceedDemo()}
                className={`flex-1 py-3 rounded-lg font-semibold text-lg transition-all ${
                  canProceedDemo()
                    ? 'bg-blue-600 text-white hover:bg-blue-700 shadow-md hover:shadow-lg'
                    : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                }`}
              >
                {canProceedDemo() ? 'Zaƒça≈• dotazn√≠k' : 'Pros√≠m, vypl≈àte v≈°etky √∫daje'}
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 p-2 sm:p-6">
      <div className="max-w-4xl mx-auto">
        <div className="mb-4 sm:mb-6">
          <h1 className="text-2xl sm:text-3xl font-bold text-gray-800 px-2">Dotazn√≠k mor√°lneho spr√°vania, odolnosti a emocion√°lnej stability</h1>
        </div>

        {renderSection()}

        <div className="flex gap-2 sm:gap-4 mt-6 sm:mt-8">
          {currentSection > 0 && (
            <button
              onClick={() => setCurrentSection(currentSection - 1)}
              className="flex items-center gap-1 sm:gap-2 px-4 sm:px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm sm:text-base"
            >
              <ChevronLeft className="w-4 h-4 sm:w-5 sm:h-5" />
              Sp√§≈•
            </button>
          )}
          
          {currentSection < sections.length - 1 && (
            <button
              onClick={() => setCurrentSection(currentSection + 1)}
              disabled={!canProceed()}
              className={`flex items-center gap-1 sm:gap-2 px-4 sm:px-6 py-3 rounded-lg ml-auto text-sm sm:text-base ${
                canProceed() ? 'bg-blue-600 text-white hover:bg-blue-700' : 'bg-gray-300 text-gray-500 cursor-not-allowed'
              }`}
            >
              ƒéalej
              <ChevronRight className="w-4 h-4 sm:w-5 sm:h-5" />
            </button>
          )}
          
          {currentSection === sections.length - 1 && (
            <button
              onClick={() => setShowResults(true)}
              disabled={!canProceed()}
              className={`flex items-center gap-1 sm:gap-2 px-4 sm:px-6 py-3 rounded-lg ml-auto text-sm sm:text-base ${
                canProceed() ? 'bg-green-600 text-white hover:bg-green-700' : 'bg-gray-300 text-gray-500 cursor-not-allowed'
              }`}
            >
              <BarChart3 className="w-4 h-4 sm:w-5 sm:h-5" />
              Zobrazi≈• v√Ωsledky
            </button>
          )}
        </div>

        <div className="mt-4 sm:mt-6 text-center text-xs sm:text-sm text-gray-500">
          {canProceed() ? (
            <span className="text-green-600 font-semibold">‚úì V≈°etky ot√°zky zodpovedan√©</span>
          ) : (
            <span>Pros√≠m zodpovedajte v≈°etky ot√°zky pred pokraƒçovan√≠m</span>
          )}
        </div>
      </div>
    </div>
  );
};

export default ComprehensiveQuestionnaire;
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<ComprehensiveQuestionnaire />);
    </script>
</body>
</html>
